<!DOCTYPE html>
<html>
<head>
  <title>IMEI Location Tracker</title>
</head>
<body>
  <h1>Tracking Device Location</h1>
  <p id="status">Waiting for location...</p>

  <script>
    let imei = prompt("Enter IMEI:");
    if (!imei) {
      alert("IMEI is required. Reload the page to try again.");
      throw new Error("IMEI required");
    }

    if (!navigator.geolocation) {
      alert("Geolocation is not supported by your browser.");
    } else {
      navigator.geolocation.watchPosition(
        async function (position) {
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;

          document.getElementById("status").textContent =
            `Sending location: ${latitude}, ${longitude}`;

          try {
            const response = await fetch("https://imei-tracker.onrender.com/update_location", {
              method: "POST",
              headers: {
                "Authorization": "Bearer supersecrettoken123",
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                imei: imei,
                latitude: latitude,
                longitude: longitude
              })
            });

            const result = await response.json();
            console.log("Server response:", result);
          } catch (error) {
            console.error("Error sending location:", error);
          }
        },
        function (error) {
          document.getElementById("status").textContent =
            "Error getting location: " + error.message;
        },
        {
          enableHighAccuracy: true,
          maximumAge: 0,
          timeout: 10000
        }
      );
    }
  </script>
</body>
</html>
